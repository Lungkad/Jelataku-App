<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css" />
    <link
      rel="stylesheet"
      href="https://pro.fontawesome.com/releases/v5.10.0/css/all.css" />
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <link
      rel="stylesheet"
      href="https://api.tiles.mapbox.com/mapbox.js/plugins/leaflet-locatecontrol/v0.43.0/L.Control.Locate.css" />
    <style>
      #map {
        width: 100%;
        height: 450px;
      }
    </style>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css"
      integrity="sha512-SzlrxWUlpfuzQ+pcUCosxcglQRNAq/DZjVsC0lE40xsADsfeQoEypE+enwcOiGjk/bSuGGKHEyjSoQ1zVisanQ=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer" />
  </head>
  <body>
    <div class="min-h-screen bg-gray-100">
      <div
        class="fixed z-10 flex flex-col h-full w-64 bg-gray-800 text-gray-300 shadow-lg"
        style="display: none"
        id="mySidebar">
        <nav class="flex-col px-4 mt-5">
          <a
            onclick="closeTab()"
            class="flex items-center px-4 py-2 text-base text-gray-100 rounded-lg hover:bg-gray-700 hover:text-gray-300">
            <i class="fa-solid fa-xmark mr-3 text-gray-400"></i>
          </a>
          <a
            href="#"
            class="flex items-center px-4 py-2 text-base text-gray-100 rounded-lg hover:bg-gray-700 hover:text-gray-300">
            <i class="fa-solid fa-home mr-3 text-gray-400"></i>
            Home
          </a>
          <a
            href="#"
            class="flex items-center px-4 py-2 text-base text-gray-100 rounded-lg hover:bg-gray-700 hover:text-gray-300">
            <i class="fa-solid fa-map-location-dot mr-3 text-gray-400"></i>
            Map
          </a>
          <a
            href="#"
            class="flex items-center px-4 py-2 text-base text-gray-100 rounded-lg hover:bg-gray-700 hover:text-gray-300">
            <i class="fa-solid fa-plus mr-3 text-gray-400"></i>
            Input Data
          </a>
          <a
            href="#"
            class="flex items-center px-4 py-2 text-base text-gray-100 rounded-lg hover:bg-gray-700 hover:text-gray-300">
            <i class="fa-solid fa-map-pin mr-3 text-gray-400"></i>
            List Data
          </a>
          <div class="absolute bottom-0 mb-1 w-full">
            <button
              onclick="confirmSignOut()"
              type="button"
              class="flex items-center px-4 py-2 text-base text-gray-100 rounded-lg hover:bg-gray-700 hover:text-gray-300">
              <i class="fa-solid fa-right-from-bracket mr-3 text-gray-400"></i>
              Sign Out
            </button>
          </div>
        </nav>
      </div>
      <main class="flex flex-col mx-auto">
        <div class="mb-4 flex-grow bg-gray-800 py-3">
          <a onclick="openTab()" class="text-2xl text-gray-100 mb-4 ml-4">
            â˜°
          </a>
          <a class="text-xl text-gray-100 mb-4 ml-2">Map</a>
        </div>
        <div class="container-fluid mt-2 mb-2">
          <section class="content">
            <div class="row">
              <div class="col-12">
                <form name="submit-to-google-sheet">
                  <div class="card shadow" id="datalokasiobjek">
                    <div class="card-body">
                      <div class="row">
                        <div class="col-sm">
                          <div class="form-group">
                            <label for="wisata"
                              ><strong>Nama Objek</strong></label
                            >
                            <input
                              type="text"
                              class="form-control text-primary"
                              id="wisata"
                              name="wisata"
                              placeholder="Nama objek"
                              value="" />
                          </div>
                        </div>
                      </div>
                      <div class="row">
                        <div class="col-sm">
                          <div class="form-group">
                            <label for="deskripsi"
                              ><strong>Deskripsi</strong></label
                            >
                            <textarea
                              type="text"
                              class="form-control text-primary"
                              id="deskripsi"
                              name="deskripsi"
                              placeholder="Deskripsi"
                              rows="3"></textarea>
                          </div>
                        </div>
                      </div>
                      <div class="row">
                        <div class="col-sm">
                          <div class="form-group">
                            <label for="alamat"><strong>Alamat</strong></label>
                            <textarea
                              type="text"
                              class="form-control text-primary"
                              id="alamat"
                              name="alamat"
                              placeholder="Alamat"
                              value=""></textarea>
                          </div>
                        </div>
                      </div>
                      <div class="row">
                        <div class="col-sm">
                          <div class="form-group">
                            <label for="htm"><strong>HTM</strong></label>
                            <textarea
                              type="text"
                              class="form-control text-primary"
                              id="htm"
                              name="htm"
                              placeholder="HTM"
                              value=""></textarea>
                          </div>
                        </div>
                      </div>
                      <div class="row">
                        <div class="col-sm">
                          <div class="form-group">
                            <label for="deskripsi"><strong>Tipe</strong></label>
                            <textarea
                              type="text"
                              class="form-control text-primary"
                              id="tipe"
                              name="tipe"
                              placeholder="Tipe"
                              value=""></textarea>
                          </div>
                        </div>
                      </div>
                      <div class="row">
                        <div class="col-sm">
                          <div class="form-group">
                            <label for="latitude"
                              ><strong>Latitude</strong></label
                            >
                            <input
                              type="text"
                              class="form-control text-primary"
                              id="latitude"
                              name="latitude"
                              placeholder="Latitude"
                              value="" />
                          </div>
                        </div>
                        <div class="col-sm">
                          <div class="form-group">
                            <label for="longitude"
                              ><strong>Longitude</strong></label
                            >
                            <input
                              type="text"
                              class="form-control text-primary"
                              id="longitude"
                              name="longitude"
                              placeholder="Longitude"
                              value="" />
                          </div>
                        </div>
                        <div class="col-sm-3">
                          <div class="form-group">
                            <label><strong>&nbsp;</strong></label
                            ><br />
                            <a
                              href="#"
                              type="button"
                              class="btn btn-danger btn-block"
                              id="mapbutton"
                              onclick="mapCenter()"
                              ><i class="fas fa-search-location"></i> Cari</a
                            >
                          </div>
                        </div>
                      </div>
                      <hr />
                      <div class="card p-1" id="mapcoordinate">
                        <div id="map"></div>
                      </div>
                    </div>
                    <div class="card-footer">
                      <div class="row">
                        <div class="col">
                          <button
                            type="button"
                            class="btn btn-secondary"
                            onclick="resetform()">
                            <i class="fas fa-times-circle"></i> Reset
                          </button>
                        </div>
                        <div class="col text-right">
                          <button
                            type="submit"
                            class="btn btn-primary btn-simpan">
                            <i class="fas fa-save"></i> Simpan
                          </button>
                          <button
                            class="btn btn-primary btn-loading d-none"
                            type="button"
                            disabled>
                            <span
                              class="spinner-border spinner-border-sm"
                              role="status"
                              aria-hidden="true"></span>
                            Loading...
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>
                </form>
              </div>
            </div>
          </section>
        </div>
      </main>
    </div>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js"></script>
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-hash/0.2.1/leaflet-hash.min.js"></script>
    <script src="https://api.tiles.mapbox.com/mapbox.js/plugins/leaflet-locatecontrol/v0.43.0/L.Control.Locate.min.js"></script>
    <script>
      /* Initial Map */
      let tooltip =
        'Drag the marker or move the map<br>to change the coordinates<br>of the location';
      let center = [-7.801389645, 110.364775452];
      let map = L.map('map').setView(center, 15); //lat, long, zoom
      map.scrollWheelZoom.disable(); //disable zoom with scroll

      /* Tile Basemap */
      let basemap = L.tileLayer(
        'https://{s}.google.com/vt/lyrs=s&x={x}&y={y}&z={z}',
        {
          maxZoom: 20,
          subdomains: ['mt0', 'mt1', 'mt2', 'mt3'],
          attribution:
            'Google Satellite | <a href="https://unsorry.net" target="_blank">unsorry@2021</a>',
        },
      );
      basemap.addTo(map);

      /* Display zoom, latitude, longitude in URL */
      let hash = new L.Hash(map);

      /* Marker */
      let marker = L.marker(center, {draggable: true});
      marker.addTo(map);

      /* Tooltip Marker */
      marker.bindTooltip(tooltip);
      marker.openTooltip();

      //Dragend marker
      marker.on('dragend', dragMarker);

      //Move Map
      map.addEventListener('moveend', mapMovement);

      function dragMarker(e) {
        let latlng = e.target.getLatLng();

        //Displays coordinates on the form
        document.getElementById('latitude').value = latlng.lat.toFixed(5);
        document.getElementById('longitude').value = latlng.lng.toFixed(5);

        //Change the map center based on the marker location
        map.flyTo(new L.LatLng(latlng.lat.toFixed(9), latlng.lng.toFixed(5)));
      }

      function mapMovement(e) {
        let mapcenter = map.getCenter();

        //Displays coordinates on the form
        document.getElementById('latitude').value = mapcenter.lat.toFixed(5);
        document.getElementById('longitude').value = mapcenter.lng.toFixed(5);

        //Create marker
        marker
          .setLatLng([mapcenter.lat.toFixed(5), mapcenter.lng.toFixed(5)])
          .update();
        marker.on('dragend', dragMarker);
      }

      function mapCenter(e) {
        let mapcenter = map.getCenter();
        let x = document.getElementById('longitude').value;
        let y = document.getElementById('latitude').value;

        map.flyTo(new L.LatLng(y, x), 18);
      }

      /* GPS enabled geolocation control set to follow the user's location */
      var locateControl = L.control
        .locate({
          position: 'topleft',
          drawCircle: true,
          follow: true,
          setView: true,
          keepCurrentZoomLevel: true,
          markerStyle: {
            weight: 1,
            opacity: 0.8,
            fillOpacity: 0.8,
          },
          circleStyle: {
            weight: 1,
            clickable: false,
          },
          icon: 'fa fa-crosshairs',
          metric: true,
          strings: {
            title: 'Lokasi Anda',
            popup: 'Lokasi Anda sekarang di sini<br>Akurasi {distance} {unit}',
            outsideMapBoundsMsg: 'Sepertinya Anda berada di luar batas Peta.',
          },
          locateOptions: {
            maxZoom: 18,
            watch: true,
            enableHighAccuracy: true,
            maximumAge: 10000,
            timeout: 10000,
          },
        })
        .addTo(map);

      // Submit to google spreadsheet
      const scriptURL =
        'https://script.google.com/macros/s/AKfycbxuJzoOZGXAzU-w0y5W9uZBSra6oymcyXQLMAl-XRqK71J_wDS9SPJV2PCj1LIBlTvEqw/exec';
      const form = document.forms['submit-to-google-sheet'];
      const btnSimpan = document.querySelector('.btn-simpan');
      const btnLoading = document.querySelector('.btn-loading');
      const myAlert = document.querySelector('.my-alert');

      form.addEventListener('submit', e => {
        e.preventDefault();
        btnSimpan.classList.toggle('d-none');
        btnLoading.classList.toggle('d-none');
        fetch(scriptURL, {method: 'POST', body: new FormData(form)})
          .then(response => {
            console.log('Success!', response);
            btnSimpan.classList.toggle('d-none');
            btnLoading.classList.toggle('d-none');
            myAlert.classList.toggle('d-none');
            // reload page
            form.reset();
            window.location.reload();
          })
          .catch(error => console.error('Error!', error.message));
      });

      function resetform() {
        form.reset();
        window.location.reload();
      }
      function openTab() {
        document.getElementById('mySidebar').style.display = 'block';
      }

      function closeTab() {
        document.getElementById('mySidebar').style.display = 'none';
      }
    </script>
  </body>
</html>